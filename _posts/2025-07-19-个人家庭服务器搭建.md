---
layout: post
title: 个人家庭服务器搭建
subtitle: 个人家庭服务器搭建
date: 2025-07-19 16:33
author: Kyon-H
header-img: img/post-bg-2015.jpg
tags:
  - 服务器
published: false
---
# 个人家庭服务器搭建

## 背景



**是什么**：

家庭服务器来说可以是一台电脑，可以是一台NAS，可以是一个N1盒子，也可以是一个树莓派，但凡是可以连接网络，并且满足我们日常需求的智能设备，都可以称为家庭服务器。

**为什么：**

| —   |              家庭服务器               |            云服务器            |
| --- | :------------------------------: | :------------------------: |
| 优点  |        价格便宜、自由购买配件、可拓展性强         | 有公网IP、装系统方便、新人价格便宜、有客服保障售后 |
| 缺点  | 可能无公网IP、自付电费、噪声大，占空间、 出现问题需要自己解决 |     续费价格高、配置低，升级配置价格高昂     |

## 机器选择

企业级服务器、成品NAS、主机DIY

**企业级服务器：** 如机架式服务器、刀片式服务器，市面上比较常见的有Dell、惠普、华为、中兴品牌。

专业的服务器主机，有更加专业的服务器管理系统，还有硬件设备生产就是为了当成服务器来使用的，所以不用太担心服务器的兼容性问题，还有寿命问题，这类机器一般没这么容易坏，可拓展性强，主板上插口一般都比较丰富，可以根据自己的需求拓展各种配件。

一般这类的机器功耗高噪音比较大，耗电也高，一般会配合机柜一起使用，占用空间大。

**成品NAS：** 市面上常见品牌有群晖、威联通、铁威马、绿联、极空间等。

好的NAS，品牌生态也比较好，配套软件做的非常好，系统上手比较容易，小白入门玩一下基本就可以熟悉整个系统的玩法了。

不同品牌功能上有所不同，有的功能需要收费，不同机型功耗不同。

**个人DIY：** 说是DIY，其实只是区别于市面上的昂贵成品机器，淘汰的洋垃圾也在DIY的范畴里面。

可以根据自己需要进行搭配，适合家里有闲置老式电脑，对功耗有要求的。

需要自己装系统、软件，对个人计算机方面能力要求高。

**低功耗主机：** 这类产品主要是一些工控机，或者是成品小主机，体积小、功耗低，只有几瓦。

拓展性差，稳定性差。
### 个人组装优势

✅ **硬件自由搭配**：按需选择低功耗CPU（如Intel T系列）、ECC内存
✅ **扩展性强**：自由添加硬盘、GPU、PCIe设备
✅ **成本可控**：二手硬件（如退役服务器配件）可降低50%+成本
✅ **技能提升**：深度理解硬件架构、Linux系统及网络原理

## 如何搭建

### 网络配置

申请公网IP或开启IPv6

光猫改**桥接模式**，路由器拨号（提升NAT性能）

路由器配置
### 硬件配置

| **组件**  | **配置**                  | **备注**        |
| ------- | ----------------------- | ------------- |
| **CPU** | Intel i3-4160           | 低功耗+核显，无需独立显卡 |
| **内存**  | DDR3 8GBx2              |               |
| **硬盘**  | SSD 120GB（系统盘）+ HDD 1TB | 兼顾速度与数据安全     |
| **其他**  | 智能插座                    | 来电自启，远程开机     |

### 系统安装与分区

**推荐系统**：**Ubuntu 22.04 LTS**（长期支持版，社区资源丰富）

低于此版本导致有些软件无法安装

**其他系统：**
- Debian：更轻量，适合老硬件
- OpenMediaVault：专注NAS场景

**文件系统格式：** 
- EXT4：Linux最常用的文件系统，稳定可靠
- Btrfs：支持快照、压缩、数据校验
- NTFS: 与Windows兼容（需要额外驱动）

**分区方案**（示例：120G + 1T）

| 分区    | 推荐大小 | 实际使用 |
| ----- | ---- | ---- |
| /boot | 1G   | 300M |
| /tmp  | 5G   | 30M  |
| /     | 100G | 56G  |
| swap  | 8G   | 1G   |
| /home | 1T   |      |

/boot是存放操作系统内核和启动过程中所需文件的地方。这个分区的存在对于系统的启动至关重要，尤其是在主要的根分区出现问题时，有了单独的boot分区，计算机仍然能够启动。因此，合理规划boot分区的大小对于系统的稳定运行非常重要。

/tmp 用来存放临时文件。这对于多用户系统或者网络服务器来说是有必要的。这样即使程序运行时生成大量的临时文件，或者用户对系统进行了错误的操作，文件系统的其它部分仍然是安全的。因为文件系统的这一部分仍然还承受着读写操作，所以它通常会比其它的部分更快地发生问题。这个目录是任何人都能访问的，所以需要定期清理。

/var /usr推荐单独分区的目录，var目录42G（docker overlay2 33G），usr目录12G
### 软件配置

#### 基础软件配置

##### ssh

修改默认端口、禁用密码登录

配置登录通知：编辑`/etc/pam.d/sshd`，添加：

```text
session optional pam_exec.so /usr/local/bin/notify.sh  
```

（`notify.sh` 脚本调用Telegram/Bark发送登录告警）
##### vpn

**tailscale**

- **原理**：基于WireGuard的加密点对点VPN
- **核心功能**：
  - **Subnets**：将服务器暴露给Tailscale网络内的设备
  - **Exit Nodes**：设备流量通过服务器出口访问公网
  - **MagicDNS**：`your-server.tailnet.ts.net` 直接访问

##### 服务器面板 1Panel

**对比宝塔的优势**：

- 开源可审计（避免宝塔后门争议）
- 容器化部署（所有服务基于Docker，隔离性强）
- 资源占用低（约200MB内存）
- 集成K8s管理和WordPress托管

##### WAF 雷池

- **开箱即用**：一键阻断SQL注入/XSS攻击
- **低侵入性**：反向代理模式部署，无需改应用代码
- **可视化报表**：实时攻击地图、威胁类型统计

### 域名与证书配置

#### 购买域名

阿里云、腾讯云购买域名，新人1元，`.top`、`.xin` 首年12元，续费30多

cloudflare托管，提供多种免费服务

免费三级域名，缺点：名称长，解析慢
#### ddns

| **工具**      | **特点**                |
| :---------- | :-------------------- |
| **ddns-go** | 单文件运行，支持30+服务商        |
| **Lucky**   | 集成STUN内网穿透、SSL证书申请    |
| **自写脚本**    | 用Cloudflare API定时更新IP |

#### acme.sh安装证书

**优势**：

- 支持多域名（含通配符证书）

- 自动续期（cron定时任务）

- 一键部署到Nginx/Apache

- 提供多种通知方式


**申请命令**：

```bash
acme.sh --config-home /home/user/xxx \
	--issue -d example.com --dns dns_cf \  
    --key-file /etc/nginx/ssl/key.pem \  
    --fullchain-file /etc/nginx/ssl/cert.pem  
```