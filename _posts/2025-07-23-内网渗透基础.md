---
layout: post
title: 内网渗透基础
subtitle: 内网渗透基础
date: 2025-07-23 16:41
author: Kyon-H
header-img: img/post-bg-2015.jpg
tags:
  - 渗透测试
  - 内网防护
published: false
---
**网络安全分类**：

1. web安全：
2. 主机安全：提权、root、
3. 内网安全：域、工作组、横向移动、端口转发、代理、持久化

![image-20221128201500632.png](https://img.ghostliner.top/4gWBVn.png)

**Windows 域（Windows Domain）** 是由 **Microsoft Windows Server** 操作系统所管理的一种网络结构，常用于企业或组织内部。它实现了对网络中用户账号、计算机、权限、安全策略等资源的**集中管理与控制**。

**域控制器（Domain Controller，DC）** 是 **Windows 域**的核心组件，用于管理和控制域中的所有身份验证、安全策略以及网络资源的访问权限。它是部署在 **Windows Server** 操作系统上的一台或多台服务器，负责执行域服务的关键功能。

**活动目录（Active Directory，AD）** 是微软开发的一种用于 Windows 域网络的集中式目录服务，旨在提供统一的管理和存储网络资源的方法。通过活动目录，管理员可以轻松地管理用户账户、计算机账户、安全证书等信息，并执行其他相关的网络管理任务。

![image.png](https://img.ghostliner.top/WJHO09.png)

企业网络安全区域划分

![image.png](https://img.ghostliner.top/yxVwLM.png)

## 1. Windows 认证

### 1.1. 本地认证

单台电脑的认证，认证流程：

![image.png](https://img.ghostliner.top/98aJ5m.png)

LM 与 NTLM 哈希

本地用户密码存储格式：

Windows 操作系统使用两种方法对用户明文密码进行加密，这两种方法分别是 LM Hash 和 NTLM Hash。在域环境中，用户信息存储在 ntds.dit 文件中，密码以哈希值的形式进行加密。Windows 操作系统中的密码通常由 LM Hash 和 NTLM Hash 两部分组成，格式通常如下：

```text
# username:RID:LM_HASH:NTLM_HASH:::
Administrator:500:6F08D7B306B1DAD4B75E0C8D76954A50:570A9A65DB8FBA761C1008A51D4C95AB:::
```

从 Windows Vista 和 Windows Server 2008 开始，微软默认禁用了 LM Hash。禁用 LM Hash 可以提高系统的安全性，防止通过暴力破解 LM 哈希值来恢复明文密码。当 LM Hash 被禁用时，如果通过工具抓取密码哈希，LM Hash 通常会显示为：

```text
aad3b435b51404eeaad3b435b51404ee #这个值表示 LM Hash 已被禁用或为空值
```

#### 1.1.1. LM HASH 生成原理

1. 密码转为大写
2. 转为 16 进制
3. 不足 14 位时补 00，多于 14 位舍去
4. 7 位为一组，分为 2 组
5. 每组转为 2 进制
6. 每 7 个 bit 后面添加 0
7. 将上述 2 进制转为 16 进制
8. 将上述两组 8 字节编码，分别作为 DES 加密 key 为魔术字符串`KGS!@#$%`加密
9. 将两组数据合并就是 LM 哈希值

```text
# Admin@123 LM-HASH
6F08D7B306B1DAD4B75E0C8D76954A50
```

#### 1.1.2. NTLM HASH 生成原理

1. 明文转为 16 进制
2. 转为 Unicode
3. MD4 加密，加密结果为 NTML 哈希值

### 1.2. 网络认证

NTLM 协议：LM、NTLMv1 、NTLMv2

### 1.3. 域认证

Kerberos 协议

组成：客户端 Client、服务端 Server、密钥分发中心 KDC（认证服务器 AS、票据授予服务器 TGS）

票据授予票据 TGT、服务票据 ST

黄金票据：伪造 TGT。白银票据：伪造 ST。黄金票据权限更高。

![image.png](https://img.ghostliner.top/YXUQKg.png)
