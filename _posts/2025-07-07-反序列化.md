---
layout: post
title: 反序列化漏洞
subtitle: unserialize
date: 2025-07-07 10:58
author: Kyon-H
header-img: img/post-bg-2015.jpg
tags: 
published: false
---
## 1. 漏洞介绍

**序列化**：把对象转换为字节序列的过程，即把对象转换为可以存储或传输的数据的过程。例如将内存中的对象转换为二进制数据流或文件，在网络传输过程中，可以是字节或是XML等格式。

**反序列化**：把字节序列恢复为对象的过程，即把可以存储或传输的数据转换为对象的过程。例如将二进制数据流或文件加载到内存中还原为对象。

## 2. PHP 反序列化

PHP中通常使用`serialize`函数进行序列化，使用`unserialize`函数进行反序列化

```
NULL被序列化为：N
Boolean型数据序列化为：b:1，b:0，分别代表True和False
Integer型数据序列化为：i:数值
String型数据序列化为：s:长度:"值"
对象序列化为：O:类名长度:类名:字段数:字段
```

序列化代码：

```php
<?php  
highlight_file(__FILE__);  
class S{  
    var $test='<script>alert(123);</script>';  
}  
  
$ctfer=new S(); //实例化一个对象  
echo serialize($ctfer);  
?>
```

### 2.1. 魔术方法

| 方法              | 作用                               |
| --------------- | -------------------------------- |
| __construct()   | 在实例化对象时触发                        |
| __destruct()    | 在对象被销毁时触发                        |
| __sleep()       | 在进行序列化时触发                        |
| __wakeup()      | 在进行反序列化时触发                       |
| __serialize()   | 在进行序列化时触发                        |
| __unserialize() | 在进行反序列化时触发                       |
| __toString()    | 被当成字符串调用时                        |
| __invoke()      | 被当成函数调用时                         |
| __set()         | 给不可访问或者不存在的属性赋值时                 |
| __get()         | 调用不可访问或者不存在的属性的值时                |
| __isset()       | 对不可访问或不存在的属性调用 isset()或 empty()时 |
| __unset()       | 对不可访问或不存在的属性调用 unset()时          |
| __call()        | 调用不可访问的方法时                       |
| __callStatic()  | 在静态上下文中调用一个不可访问的方法时              |

## 3. JAVA 序列化和反序列化

序列化：OutputObjectStream 类 writeObject()方法

反序列化：InputObjectStream 类 readObject()方法

**特征参考：**

以 rO 0 AB 开头，基本确定为 java 序列化 base 64 加密数据。

以 aced 开头，基本确定为 Java 序列化 16 进制数据。
